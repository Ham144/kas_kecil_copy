generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  username        String @id
  description String
  isActive Boolean @default(true)
  displayName String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  flowLogs FlowLog[]
  warehouseId String?
  warehouse Warehouse? @relation(fields: [warehouseId], references: [id])
  Globalsetting Globalsetting[]
  two_faIsVerified Boolean  @default(false)
  two_faSecret String? 
  authMethod AuthMethod @default(LDAP)
}

enum AuthMethod {
  LDAP
} 

model Warehouse {
  id String @id @default(uuid())
  name        String @unique
  budgets     Budget[]
  flowLogs FlowLog[]
  members User[]
}


model Budget {
  id         String   @id @default(uuid())
  warehouseId String
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  month       Int
  year        Int
  amount      Float
}


model FlowLog {
  id String @id @default(uuid())
  title String
  amount Float
  note String
  attachments String[]
  type FlowLogType
  userId String
  createdBy User @relation(fields: [userId], references: [username])
  warehouseId String
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  categoryId String
  category FlowLogCategory @relation(fields: [categoryId], references: [id])
  createdAt DateTime @default(now()) //no updateAt, bisa kacau
}
enum FlowLogType {
  IN
  OUT
}

model FlowLogCategory {
  id String @id @default(uuid())
  no String @unique //account number
  name String @unique
  description String
  flowLogs FlowLog[]
}

model Globalsetting {
  settingName String @id @default(uuid())
  AD_HOST String
  AD_PORT String
  AD_DOMAIN String
  AD_BASE_DN String

  SOAP_CUSTOMER_URL String
  SOAP_CUSTOMER_SOAPACTION String
  SOAP_CUSTOMER_USERNAME String
  SOAP_CUSTOMER_PASSWORD String
  
  inUse Boolean @default(true)
  createdById String?
  createdBy User? @relation(fields: [createdById], references: [username]) 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}