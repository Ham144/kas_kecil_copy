generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  username        String @id
  description String @default("kasir") //ini bebas
  role ROLE @default(KASIR) //ini yang menentukan RBAC
  isActive Boolean @default(true)
  displayName String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  flowLogs FlowLog[]
  warehouseId String?
  warehouse Warehouse? @relation(fields: [warehouseId], references: [id])
  Globalsetting Globalsetting[]
}

enum ROLE {
  KASIR
  ADMIN
  IT
}

enum AuthMethod {
  LDAP
} 

model Warehouse {
  id        String     @id @default(uuid())
  name String @unique
  members User[]
  flowLogs  FlowLog[]
}

model Budget {
  id           String   @id @default(uuid())
  categoryId   String
  category     FlowLogCategory @relation(fields: [categoryId], references: [id])
  month        Int
  year         Int
  amount       Float
}

model FlowLog {
  id String @id @default(uuid())
  title String
  amount Float
  note String
  attachments String[]
  type FlowLogType 
  createdByUsername String
  createdBy User @relation(fields: [createdByUsername], references: [username])
  warehouseId String
  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
  categories FlowLogCategory[]
  date DateTime @default(now()) 
  categoryId String
  createdAt DateTime @default(now()) //no updateAt, bisa kacau
}

enum FlowLogType {
  IN
  OUT
}

model FlowLogCategory {
  id String @id @default(uuid())
  no String @unique //account number
  name String
  description String
  budgets Budget[]
  flowLogs FlowLog[]
  updatedAt DateTime @updatedAt() @default(now())
  warehouseId String

  @@unique([name, warehouseId])
}

model Globalsetting {
  settingName String @id @default(uuid())
  AD_HOST String
  AD_PORT String
  AD_DOMAIN String
  AD_BASE_DN String

  inUse Boolean @default(true)
  createdById String?
  createdBy User? @relation(fields: [createdById], references: [username]) 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}